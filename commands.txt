These commands are for mostly for updating the pipeline
and one command is for recovering BigQuery data.

- Set secret:

kubectl create secret generic gbq --from-file=gbq.json=./keys/gbq.json


- Update containers:

cd collect_job_listings
docker build -t gcr.io/techlistme/collect-job-listings:latest .
docker push gcr.io/techlistme/collect-job-listings:latest
cd ..

cd clean_duplicate_ids
docker build -t gcr.io/techlistme/clean-duplicate-ids:latest .
docker push gcr.io/techlistme/clean-duplicate-ids:latest
cd ..

cd enrich_job_listings
docker build -t gcr.io/techlistme/enrich-job-listings:latest .
docker push gcr.io/techlistme/enrich-job-listings:latest
cd ..

cd clean_duplicate_descriptions
docker build -t gcr.io/techlistme/clean-duplicate-descriptions:latest .
docker push gcr.io/techlistme/clean-duplicate-descriptions:latest
cd ..

cd extract_gemini
docker build -t gcr.io/techlistme/extract-gemini:latest .
docker push gcr.io/techlistme/extract-gemini:latest
cd ..


- Apply changes

kubectl apply -f .\k8s\ --recursive


- Apply configmap

cd k8s/jobs
kubectl create configmap job-01-collect-job-listings --from-file=01-collect-job-listings.yaml -o yaml | kubectl apply -f -
kubectl create configmap job-02-clean-duplicate-ids --from-file=02-clean-duplicate-ids.yaml -o yaml | kubectl apply -f -
kubectl create configmap job-03-enrich-job-listings --from-file=03-enrich-job-listings.yaml -o yaml | kubectl apply -f -
kubectl create configmap job-04-clean-duplicate-descriptions --from-file=04-clean-duplicate-descriptions.yaml -o yaml | kubectl apply -f -
kubectl create configmap job-05-extract-gemini --from-file=05-extract-gemini.yaml -o yaml | kubectl apply -f -


- Recover BigQuery table from an hour ago

bq cp techlistme:raw_data.jobs@-3600000 techlistme:raw_data.jobs_recovered